<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" creationComplete="onCreationComplete();">
<mx:Script>
	<![CDATA[
		import mx.collections.ArrayCollection;
		import mx.rpc.events.ResultEvent;
		import mx.events.ListEvent;
		import dto.security.video.VideoType;
		import mx.controls.Alert;
		
		/**
		 * 根分类数据集
		 * */
		[Bindable]
		private var rootTypeDatas:ArrayCollection;
		
		/**
		 * 子分类数据集
		 * */
		[Bindable]
		private var parentTypeDatas:ArrayCollection;
		
		/**
		 * 子分类获得设置
		 * */		
		public var indexSet:int=-1;
		
		/**
		 * 根分类获得设置
		 * */
		public var rootIndexSet:int=-1;
		
		/**
		 * 初始化组件调用
		 * */
		private function onCreationComplete():void{
			var arrayTemp:ArrayCollection = new ArrayCollection;
			videoTypeService.getRootVideoTypes();
			var videoType:VideoType =new VideoType();
			videoType.typeName="请选择";
			videoType.typeId=-1;
			videoType.videoNum=0;
			arrayTemp.addItemAt(videoType,0);
			
			parentTypeDatas=arrayTemp;
		}
			
		/**
		 * 查询顶级分类信息响应调用
		 * */
		private function getRootVideoTypesHandler(event:ResultEvent):void{
			
			var arrayTemp:ArrayCollection=event.result as ArrayCollection;
			var videoType:VideoType = new VideoType();
			
			videoType.typeName="请选择";
			videoType.typeId=-1;
			videoType.videoNum=0;
			arrayTemp.addItemAt(videoType,0);
			rootTypeDatas=arrayTemp;
			
			setSelectIndex(rootTypeDatas);
			
			setSelectRootIndex(rootTypeDatas);
		}
		
		/**
		 * 查询二级分类信息响应调用
		 * */
		 public function getParentVideoTypes(rootId:int):void
		 {
		 	var typeId:int =rootId;
		 	videoTypeService.getParentVideoTypes(typeId);
		 }
		 
		 /**
		 * 查询二级分类信息响应调用
		 * */
		 private function getParentVideoTypesHandler(event:ResultEvent):void
		 {
		 		var arrayTemp:ArrayCollection=event.result as ArrayCollection;
		 		var videoType:VideoType =new VideoType();
		 		videoType.typeName="请选择";
		 		videoType.typeId =-1;
		 		videoType.videoNum=0;
		 		arrayTemp.addItemAt(videoType,0);
		 		parentTypeDatas =arrayTemp;
		 		
		 		setSelectIndex(parentTypeDatas);
		 }
		
		/**
		 * 获得所选分类信息
		 * */
		public function getSelectedVideoType():VideoType{
			return parentVideoTypeCB.selectedItem as VideoType;
		}
		
		/**
		 * 获得所选子分类信息
		 * */
		public function getSelectParentVideoType():VideoType
		{
			return rootVideoTypeCB.selectedItem as VideoType;
		}
		
		/**
		 * 获得所选分类信息
		 * */
		public function getSelectIndex(newIndex:int):void{
				indexSet = newIndex;
		}
		
		/**
		 * 顶级分类获得选项
		 * */
		public function getRootVideoTypeSetSelectIndex(rootNewIndex:int):void{
				rootIndexSet=rootNewIndex;
		}
		
		/**
		 * 设置顶级分类所选的分类信息
		 * */
		private function setSelectRootIndex(newVideoType:ArrayCollection):void{
			for(var i:int=0;i<newVideoType.length;i++){
				if(rootIndexSet==parseInt(Object(newVideoType.getItemAt(i)).typeId)){
					rootVideoTypeCB.selectedIndex = i;
				}
			}
		}
		
		/**
		 * 设置所选分类信息
		 * */
		private function setSelectIndex(newVideoType:ArrayCollection):void{
			for(var i:int=0;i<newVideoType.length;i++){
				if(indexSet==parseInt(Object(newVideoType.getItemAt(i)).typeId)){
					parentVideoTypeCB.selectedIndex = i;
				}
			}
		}
		
		private function onChangeRoot(event:ListEvent):void{
			var videoType:VideoType=rootVideoTypeCB.selectedItem as VideoType;
			this.getParentVideoTypes(videoType.typeId);
		}
		
	]]>
</mx:Script>
	<mx:RemoteObject id="videoTypeService" destination="videoTypeService" showBusyCursor="true">
		<mx:method name="getRootVideoTypes" result="getRootVideoTypesHandler(event)"/>
		<mx:method name="getParentVideoTypes" result="getParentVideoTypesHandler(event)"/>
	</mx:RemoteObject>
	<mx:ComboBox id="rootVideoTypeCB" dataProvider="{rootTypeDatas}" labelField="typeName" change="onChangeRoot(event);"/>
	<mx:ComboBox id="parentVideoTypeCB" dataProvider="{parentTypeDatas}" labelField="typeName"/>
</mx:HBox>
